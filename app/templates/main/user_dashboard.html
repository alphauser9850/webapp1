{% extends "base.html" %}

{% block title %}My Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#0A192F] text-[#E6F1FF] p-8">
    <!-- User Info Section -->
    <div class="bg-[#1B2B3A]/80 backdrop-blur-sm rounded-xl border border-[#2D4A5D] p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div>
                <h2 class="text-2xl font-semibold mb-2">Welcome, {{ current_user.username }}!</h2>
                <p class="text-[#8892B0]">{{ current_user.email }}</p>
            </div>
            <div class="mt-4 md:mt-0">
                <div class="flex items-center space-x-2">
                    <span class="text-[#8892B0]">Remaining Hours:</span>
                    <span class="px-3 py-1 rounded-full {% if current_user.remaining_hours > 0 %}bg-green-500/10 text-green-400{% else %}bg-red-500/10 text-red-400{% endif %}">
                        {{ current_user.formatted_remaining_time }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Session Alert -->
    {% if active_session %}
    <div class="bg-[#1B2B3A]/80 backdrop-blur-sm rounded-xl border border-[#2D4A5D] p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div>
                <h3 class="text-xl font-semibold mb-2">Active Lab Session</h3>
                <p class="text-[#8892B0] mb-2">Started at {{ active_session.start_time.strftime('%Y-%m-%d %H:%M') }}</p>
                <div class="font-mono text-2xl text-[#64FFDA]" id="countdown-timer">--:--:--</div>
                <span class="text-[#8892B0] text-sm">Time Remaining</span>
            </div>
            <div class="mt-4 md:mt-0">
                <a href="{{ url_for('main.lab_session', id=active_session.id) }}" 
                   class="inline-flex items-center px-6 py-3 bg-[#64FFDA] text-[#0A192F] rounded-lg hover:bg-[#64FFDA]/90 transition-colors">
                    Return to Lab
                    <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Lab Categories -->
    <div class="mb-8">
        <h3 class="text-xl font-semibold mb-6">Available Lab Categories</h3>
        
        <!-- Category Tabs -->
        <div class="mb-6 overflow-x-auto">
            <nav class="flex space-x-4" role="tablist">
                <button class="px-4 py-2 text-[#64FFDA] border-b-2 border-[#64FFDA]" role="tab" aria-selected="true">
                    <i class="fas fa-star mr-2"></i>My Labs
                </button>
                {% for track in ['CCNA', 'Enterprise', 'Security', 'Data Center', 'Collaboration', 'Other'] %}
                <button class="px-4 py-2 text-[#8892B0] hover:text-[#64FFDA] border-b-2 border-transparent hover:border-[#64FFDA]/50 transition-colors" role="tab">
                    <i class="fas fa-{{ track_icons[track] }} mr-2"></i>{{ track }}
                </button>
                {% endfor %}
            </nav>
        </div>

        <!-- Category Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for category in categories %}
            <div class="bg-[#1B2B3A]/80 backdrop-blur-sm rounded-xl border border-[#2D4A5D] p-6 hover:transform hover:-translate-y-1 transition-all duration-300">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-medium">{{ category.name }}</h4>
                    <span class="px-2 py-1 text-xs rounded-full bg-blue-500/10 text-blue-400">
                        {{ category.servers|length }} servers
                    </span>
                </div>
                <p class="text-[#8892B0] mb-4">{{ category.description }}</p>
                <div class="flex justify-end">
                    <a href="{{ url_for('main.category_servers', id=category.id) }}"
                       class="inline-flex items-center px-4 py-2 bg-[#64FFDA] text-[#0A192F] rounded-lg hover:bg-[#64FFDA]/90 transition-colors">
                        View Labs
                        <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- No Hours Warning -->
    {% if current_user.remaining_hours == 0 %}
    <div class="bg-[#1B2B3A]/80 backdrop-blur-sm rounded-xl border border-[#2D4A5D] p-6">
        <div class="flex items-start space-x-4">
            <i class="fas fa-info-circle text-[#64FFDA] text-2xl"></i>
            <div>
                <h4 class="text-lg font-medium mb-2">No Lab Hours Available</h4>
                <p class="text-[#8892B0]">You currently have no remaining hours. You can try the demo mode for each category or contact an administrator to get more lab hours.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/timer.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if active_session and (current_user.remaining_hours > 0 or active_session.is_demo) %}
    // Create and start the session timer
    const timer = new SessionTimer({
        startTime: "{{ active_session.start_time.strftime('%Y-%m-%d %H:%M:%S') }} UTC",
        durationHours: {% if active_session.is_demo %}1{% else %}{{ current_user.remaining_hours|float }}{% endif %},
        timerId: 'countdown-timer',
        onTimeUp: function() {
            window.location.href = "{{ url_for('main.user_dashboard') }}";
        }
    });
    
    timer.start();
    
    window.addEventListener('beforeunload', function() {
        timer.stop();
    });
    {% endif %}
});
</script>
{% endblock %} 